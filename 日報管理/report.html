<!DOCTYPE html>
<html lang="jp">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <?!= HtmlService.createHtmlOutputFromFile('reset').getContent(); ?>
  <?!= HtmlService.createHtmlOutputFromFile('css').getContent(); ?>
  <script>
    //作業中に画面を遷移させない用の監視変数.
  let win_lock = false;

  //日報情報に変更があった場合に呼び出される。
  let g_change_flg = false;

  //入力された日報情報を格納する多次元配列.
  //[社員ID, 日付, 開始時間, 終了時間, 作業コード, 工事No, N, A]の順で格納されている
  let g_report_data = [];

  //工事Noシートを格納する配列.
  let g_constructionData = null;

  //社員情報を格納する配列.
  let g_workerData = null;

  //休憩時間を格納する配列.
  let breakTimeAry = null;

  //作業コードの分類をキーとした連想配列("技術部作業":[1,"作図・訂正"])の様に{"分類":[作業コード,内容]}の様に入っている.
  let g_workCategories = {};

  //現在のモード(追加・編集)を表した変数.
  let g_mode = "add";

  //日報を追加する為の配列を格納する変数.
  let g_addary = null;

  //前回入力された工事No(存在する物)を格納する変数.
  let g_last_cons = "";

  //前回入力された工事No(存在する・しない混在)を格納する変数.
  let g_cons = "";

  //勤務形態に応じた色等を格納する配列.
  let g_work_style = null;

  //社員IDを格納する変数.
  let g_employeeId = <?= id ?> + "";

  let g_employeeName = <?= name ?> + "";

  let g_currentDate = <?= date ?> + "";

  //シート名を保持する変数.
  let g_sheet = null;

  let g_employee_class = "";

  //現在の作業コードのドロップダウン状態を記録する変数。Trueなら間接作業のみのモード、falseはそれを含めた全て.
  //初期状態ではドロップダウンを作成する都合上、trueに設定.
  let g_cord_drop_flg = true;

  // 指定した時間だけ待つための関数
  function wait(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
  }


  document.addEventListener('DOMContentLoaded', initialize);

  async function initialize() {
    // 作業コードを格納する変数
    let workCord = null;

    // データ読み込み完了フラグ
    let dataLoadFlags = [false, false, false, false, false, false];

    let year = parseInt(g_currentDate.split("-")[0]);
    let month = parseInt(g_currentDate.split("-")[1]);
    let day = parseInt(g_currentDate.split("-")[2]);

    // サーバーから作業コードを取得
    google.script.run.withSuccessHandler(getWorkCord).getSheetValues("作業コード");
    google.script.run.withSuccessHandler(getConstructionData).getSheetValues("工事No");
    google.script.run.withSuccessHandler(getWorkerData).getSheetValues("社員情報");
    google.script.run.withSuccessHandler(getBreakTimeData).getSheetValues("休憩時間");
    google.script.run.withSuccessHandler(getWorkStyleData).getSheetValues("勤務形態");
    google.script.run.withSuccessHandler(getWorkReportData).getSheetAtYearMonth(year, month);

    // サーバーから取得したデータを変数に格納するコールバック関数
    function getWorkCord(result) {
      workCord = result;
      dataLoadFlags[0] = true;
    }

    function getConstructionData(result) {
      g_constructionData = result;
      dataLoadFlags[1] = true;
    }

    function getWorkerData(result) {
      g_workerData = result;
      dataLoadFlags[2] = true;
    }

    function getBreakTimeData(result) {
      breakTimeAry = result;
      dataLoadFlags[3] = true;
    }

    function getWorkStyleData(result) {
      g_work_style = result;
      dataLoadFlags[4] = true;
    }

    function getWorkReportData(result) {
      g_report_data = result[0];
      g_sheet = result[1];
      //先頭行削除.
      g_report_data.shift();
      dataLoadFlags[5] = true;
    }

    // データ読み込みが完了するまで待つ
    while (!dataLoadFlags.every(flag => flag)) {
      await wait(100);
    }

    //社員IDの存在チェック.
    for ( let i = 1; i < g_workerData.length ; ++i ) {
      if ( g_workerData[i][0] == g_employeeId ) {
        g_employee_class = [g_workerData[i][5],g_workerData[i][6],g_workerData[i][7],g_workerData[i][8]];
        break;
      }

      if ( i+1 == g_workerData.length ) {
        alert("社員が存在しないようです。もう一度ログインからやり直してください");
      }
    }

    let idName = "";

    // 最初の要素が不要なので削除
    g_constructionData.shift();
    g_constructionData = g_constructionData.filter(Boolean);

    // 最初の要素が不要なので削除
    workCord.shift();
    workCord = workCord.filter(Boolean);

    // 作業コードをカテゴリ別にオプションとしてドロップダウンに追加
    for (const item of workCord) {
      const category = item[0];
      const code = item.slice(1);;
      if (g_workCategories[category]) {
        g_workCategories[category].push(code);
      } else {
        g_workCategories[category] = [code];
      }
    }

    codeChangeIndirect(false);

    //一旦テーブル作成を開始.
    report_table_create(g_report_data, "work_report");

    // ローディング画面を非表示にする
    document.getElementById("loading_text").textContent = "読み込み完了";
    await wait(900);
    document.getElementById("page_loading").style.display = "none";
    // 朝5:00以降にWindowRoad関数を実行するかどうかをチェック
    checkNextDayMorning5();
  }

  //工事名テキストボックスがクリックされた時、工事Noテキストボックスにフォーカスを移す為の関数.
  window.addEventListener('DOMContentLoaded', () => {
    document.getElementById("work_num_name").addEventListener("click", function() {
    // テキストボックスにフォーカスを移す
    document.getElementById("work_num").focus();
    });
  });

  /* 日時を取得・設定する関数開始 */
  window.addEventListener('DOMContentLoaded', () => {

    // カレンダーのヘッダーに現在の日時を設定するための要素を取得
    let dayHeader = document.getElementById("date");

    // 日付を表示するための関数
    function updateDate() {

      let date = g_currentDate.split("-");
      let year = parseInt(date[0]);
      let month = parseInt(date[1]);
      let day = parseInt(date[2]);

      let formattedDate = year + "年" + month + "月" + (day < 10 ? "0" : "") + day + "日"; // フォーマット済みの日付

      // 日付を表示する要素に設定
      dayHeader.innerHTML = formattedDate;
    }

    // 初回の日付更新
    updateDate();

  });


// Webサイトを起動した日の朝5:00の時刻を設定
var nextDayMorning5 = new Date();
nextDayMorning5.setDate(nextDayMorning5.getDate() + 1); // 翌日に設定
nextDayMorning5.setHours(5, 0, 0, 0); // 朝5:00に設定

// Webサイトを起動した時刻を記録する変数
var startTime = new Date();

// 朝5:00以降にWindowRoad関数を実行するかどうかをチェックする関数
function checkNextDayMorning5() {
    // 現在の時刻を取得
    var currentTime = new Date();

    // 現在の時刻が翌日の朝5:00以降かどうかを判定
    if (currentTime >= nextDayMorning5) {
        // WindowRoad関数を実行
        windowRoad();
    } else {
        // 朝5:00以降になるまで待機
        setTimeout(checkNextDayMorning5, nextDayMorning5 - currentTime);
    }
}


// 日報ウインドウに戻るか、カレンダー選択に向かうかを確認する.
function windowRoad() {
 document.getElementById("page_road_popup").style.display = "block";
 document.getElementById("popup_text").innerHTML = "前回起動日時から一日経ちました<br>日時選択画面に戻りますか?<br>";

  let url = "<?=getScriptUrl()?>?p=calendar&name="+g_employeeName+"&id="+g_employeeId;
  document.getElementById("popup_entry_btn").setAttribute("href", encodeURI(url));
}


/* 日時を取得・設定する関数終了 */

/* モーダルウインドウ関連の関数開始 */

// モーダルウインドウを表示する際に呼び出す関数.
function open_modal() {
  const modal = document.getElementById('modal_win');
  document.getElementById("modal_form").style.display = "block";
  document.getElementById("modal_title").textContent = "日報報告";
  g_mode = "add";
  modal.style.display = 'block';
  report_direction(); // モーダルを開く際に入力方向をチェック
}

// モーダルウインドウ内で戻るボタンが押された際の関数.
function close_modal() {
  // 日報編集モードの際にクローズボタンが押された場合、入力状況の初期化を行う.
  const modal = document.getElementById('modal_win');
  document.getElementById("modal_report").style.display = "none";
  let entry_btn = document.getElementById("entry");
  entry_btn.removeAttribute("onclick");
  modal.style.display = 'none';
  document.getElementById("delete_btns").style.display = "none";
  document.getElementById("entryTxt").textContent = "追加";
}

function exection() {
  win_lock = true;
}

// ウインドウ更新を阻止する関数.
window.addEventListener('beforeunload', function (event) {
  if (win_lock) {
    event.preventDefault(); // ページの更新を阻止
    event.returnValue = '';
    const confirmationMessage = 'このページを離れようとしています。本当によろしいですか？';
    (event || window.event).returnValue = confirmationMessage;
    return confirmationMessage;
  }
});

//工事Noが0の時(flgがtrueの時)、間接作業系列の作業コードしか選択できない様にする　flgがfalseの時は社員が出来る全ての作業コードを表示.
function codeChangeIndirect( flg ) {

  let workCordDropdown = document.getElementById("work_cord");

  if ( flg ) {
    if ( !g_employee_class.includes("間接作業") ){ return true }
    if ( g_cord_drop_flg ) {return false}

    g_cord_drop_flg = true;

    // 最初のオプション要素を除いて、すべてのオプション要素を削除
    for (let i = workCordDropdown.options.length - 1; i >= 0; i--) {
      workCordDropdown.remove(i);
    }
    for (const category in g_workCategories) {
      if (g_workCategories.hasOwnProperty(category)) {
        const codes = g_workCategories[category];
        for (let i = 0; i < codes.length; i++) {
          //作業が間接作業であればドロップダウンを作成.
          if ( g_employee_class.includes(codes[i][5]) && codes[i][4] ){
            let option = document.createElement("option");
            option.text = codes[i][0] + " 【" + category + "：" + codes[i][1] + "】";
            option.value = codes[i][0] + " 【" + category + "：" + codes[i][1] + "】";
            workCordDropdown.appendChild(option);
          }
        }
      }
    }
  } else {
    if ( !g_cord_drop_flg ) {return}
    g_cord_drop_flg = false;

    // 最初のオプション要素を除いて、すべてのオプション要素を削除
    for (let i = workCordDropdown.options.length - 1; i >= 0; i--) {
      workCordDropdown.remove(i);
    }
    for (const category in g_workCategories) {
      if (g_workCategories.hasOwnProperty(category)) {
        const codes = g_workCategories[category];
        for (let i = 0; i < codes.length; i++) {
          //社員の分類に応じて、表示する作業コードを切り替える.
          if ( g_employee_class.includes(codes[i][5])){
            let option = document.createElement("option");
            option.text = codes[i][0] + " 【" + category + "：" + codes[i][1] + "】";
            option.value = codes[i][0] + " 【" + category + "：" + codes[i][1] + "】";
            workCordDropdown.appendChild(option);
          }
        }
      }
    }
  }
}

// 開始時間と終了時間の正当性と作業コードの正当性を確認する関数.
function work_time_check(start_total_minutes, end_total_minutes, checkbox, cord) {
  let errorMessages = [false, false, false];

  let totalWorkTime = totalWorkingCalc(start_total_minutes, end_total_minutes, breakTimeAry, 0);
  if( totalWorkTime <= 0 && start_total_minutes >= end_total_minutes) {
    errorMessages[0] = "休憩時間を抜くと、作業時間が0時間になります<br>開始時間が終了時間以上に設定されています";
  }else if ( totalWorkTime <= 0 ) {
    errorMessages[0] = "休憩時間を抜くと、作業時間が0時間になります";
  }else if (start_total_minutes >= end_total_minutes) {
    errorMessages[0] = "開始時間が終了時間以上に設定されています";
  }

  if (checkbox) {
    if ( totalWorkTime < 30) {
      errorMessages[1] = true;
    }
  }

  for (let key in g_workCategories) {
    for(let i = 0; i < g_workCategories[key].length; ++i){
      if (g_workCategories[key][i][0] == cord) {
        if( !g_workCategories[key][i][3] && checkbox ) {
          errorMessages[2] = true;
        }
        break;
      }
    }
  }

  let workTxt = document.getElementById("totalWorkText"); //id要素の取得.
  if( totalWorkTime > 0 ) {
    let tmp = 0;

    if ( totalWorkTime < 30 )  {
      tmp = "0時間";
    } else if (totalWorkTime < 60)  {
      tmp = "30分";
    } else if ( totalWorkTime % 60 == 0 ) {
      tmp = Math.floor(totalWorkTime / 60) + "時間";
    } else {
      if ( totalWorkTime % 60  < 30 ) {
        tmp = Math.floor(totalWorkTime / 60) + "時間";
      } else {
        tmp = Math.floor(totalWorkTime / 60) + "時間" + 30 +"分";
      }
    }
    workTxt.textContent = tmp;
  } else {
    workTxt.textContent = "0時間";
  }
  return errorMessages;
}

// エラーメッセージを作成する関数.
function createErrorMessage(divName, errName, text) {
  if (document.getElementById(errName)) {
    removeErrorMessage(document.getElementById(errName));
  }
  let errorMessage = document.createElement('p');
  errorMessage.innerHTML = text;
  errorMessage.id = errName;
  errorMessage.classList.add("error_msg");
  let div = document.getElementById(divName);
  div.appendChild(errorMessage);
}

// 指定されたエラーメッセージを削除する関数.
function removeErrorMessage(textId) {
  if (textId) {
    textId.parentNode.removeChild(textId);
  }
}

//numsuggestのp要素をクリックした際に発火。工事Noと名前をテキストボックスに格納する.
function num_suggest_click( workNum, workName ) {
  document.getElementById("work_num").value = workNum;
  document.getElementById("work_num_name").value = workName;
  report_direction();
}

// 日報追加・編集の際に入力が起きた際に呼び出される関数.
function report_direction() {
  let start_hour = document.getElementById("start_hour").value;
  let start_minute = document.getElementById("start_minute").value;
  let end_hour = document.getElementById("end_hour").value;
  let end_minute = document.getElementById("end_minute").value;
  let cord = document.getElementById("work_cord").value;
  let num = document.getElementById("work_num").value;
  let cord_chkbx = document.getElementById("cord_chkbx").checked;
  let num_chkbx = document.getElementById("num_chkbx").checked;
  let entry_btn = document.getElementById("entry");
  entry_btn.setAttribute("onclick", "not_entry()");
  exection();

  // 全ての入力欄が空白の場合、スキップする
  if (!g_employeeId && !start_hour && !start_minute && !end_hour && !end_minute && !cord && !num) {
    return;
  }

  // 作業コード名を格納
  let cord_full_name;

  if( cord ) {
    cord_full_name = cord.split("：")[1].replace("】","");
  }

  let id_check = false;
  let time_check = false;
  let cord_check = false;
  let num_check = false;
  let cord_n_check = false;

  let errId = document.getElementById("err_id");
  let errStart = document.getElementById("err_start");
  let errEnd = document.getElementById("err_end");
  let errCord = document.getElementById("err_cord");
  let errNum = document.getElementById("err_num");

  //入力された工事Noから、テキストボックス下部の予測変換要素を作成する関数.
  function work_num_check(number, numArray) {
    let num_name = document.getElementById("work_num_name");
    let num_suggest = document.getElementById("num_suggest");
    num_suggest.innerHTML = '';

    let num_flg = false;
    let num_first_name = 0;

    for ( let i = 0 ; i < g_constructionData.length; ++i ) {
      let p = document.createElement("p");
      p.classList.add("num_suggest_option");

      if ( g_constructionData[i][1].indexOf(number) != -1 ){
        //工事Noと略称名をonclick属性に追加.
        p.setAttribute('onclick', "num_suggest_click('"+ g_constructionData[i][1] +"','"+ g_constructionData[i][2] +"')");
        p.innerText =  g_constructionData[i][1] +"【"+ g_constructionData[i][2]+"】";
        num_suggest.appendChild(p);
        if (num_first_name == 0 && g_constructionData[i][1] == number ) {
          ++num_first_name;
          num_name.value = g_constructionData[i][2];
          //工事Noが0の時、間接作業の物しか作業コードが選択できない様にする.
          if ( number == "0" ){
            //もし、社員が間接作業の出来ない社員だった場合.
            if ( codeChangeIndirect( true ) ){
              //alertを返す.
              return "間接作業が出来ない区分の為、0を選択する事は出来ません";
            }
          } else {
            codeChangeIndirect( false );
          }
        }
        num_flg = true;
      } else {
        continue;
      }
    }

    if ( num_first_name == 0 ) {
      num_name.value = "";
    }

    if( num_flg ) {
      return false
    } else {
      return "存在しない工事Noです"
    }
  }

  if (start_hour && start_minute && !$("#end_div").hasClass("active")) {
    $('#end_div').toggleClass('active');
  } else if (!start_hour && !start_minute && $("#end_div").hasClass("active")) {
    $("#end_div").toggleClass('active');
  }

  let err_flg = false;

  if (start_hour) {

    //処理の為、開始時間の時間と、終了時間の分の時間を持ってくる.
    let hour = document.getElementById("end_hour");
    let hour_op = hour.options;
    let eminute = document.getElementById("end_minute");
    let eminute_op = eminute.options;
    let shour = document.getElementById("start_hour");

    let shour_op = document.getElementById("start_hour").selectedIndex;
    let sdate = document.getElementById("start_minute");
    let sminute = document.getElementById("start_minute");

    //終了時間と開始時間の総時間=分を持ってくる.
    let start_minutes = timeCalc(shour.value +":"+ sminute.value);
    let end_minutes = timeCalc(hour.value +":"+ eminute.value);

    //フォームの終了時間よりも、開始時間の方が大きかった場合、終了時間の選択状態を解除する.
    if ( end_minutes < start_minutes) {
      hour.selectedIndex = -1;
      eminute.selectedIndex = -1;
    }

    for (let i = 1; i < hour_op.length; ++i) {
      //分を切り捨て、大小によって選択できないようにする.
      if ( timeCalc(hour_op[i].value +":00") < timeCalc(start_hour + ":00") ) {
        hour_op[i].disabled = true;
      } else {
        hour_op[i].disabled = false;
      }
    }

    //分にも、開始時間と被るものを選択できないようにする.
    for (let i = 1; i < eminute_op.length; ++i) {
      if ( shour_op == hour.selectedIndex && parseInt(eminute_op[i].value) <= parseInt(sminute.value)) {
        eminute_op[i].disabled = true;
        if( parseInt(sminute.value) > parseInt(eminute.value) ) {
          eminute.selectedIndex = -1;
        }
      } else {
        eminute_op[i].disabled = false;
      }
    }
  }

  cord = cord.split(" ")[0];
  // 時間チェック
  let errorMessages = work_time_check(timeCalc(start_hour +":"+ start_minute), timeCalc(end_hour +":"+ end_minute) , cord_chkbx, cord);
  time_check = errorMessages[0];
  cord_check = errorMessages[1];
  cord_n_check = errorMessages[2];
  if (start_hour && start_minute) {
    if (time_check) {
      createErrorMessage("start_div", "err_start", time_check);
      createErrorMessage("end_div", "err_end", time_check);
      err_flg = true;
    } else {
      removeErrorMessage(errStart);
      removeErrorMessage(errEnd);
    }
  }

  //入力された時間に応じ、テキストの色を変える.
  //開始時間に色を付ける.
  if ( start_hour && start_minute ) {
    textColorChange( timeCalc( start_hour + ":" + start_minute) ,"start_hour", "start_minute" );
  }

  if( end_hour && end_minute ) {
    textColorChange( timeCalc( end_hour + ":" + end_minute ), "end_hour", "end_minute");
  }


  // 作業コードチェック
  if (cord) {
    if (cord_check && cord_chkbx && cord_n_check) {
      createErrorMessage("cord_div", "err_cord", "手直しができない作業コードです<br>30分以下の作業にはN(手直し)は付けられません");
      err_flg = true;
    } else if (cord_check && cord_chkbx) {
      createErrorMessage("cord_div", "err_cord", "30分以下の作業にはN(手直し)は付けられません");
      err_flg = true;
    } else if (cord_chkbx && cord_n_check) {
      createErrorMessage("cord_div", "err_cord", "手直しができない作業コードです");
      err_flg = true;
    } else {
      removeErrorMessage(errCord);
    }
  }

  // 工事Noチェック
  if ( num ) {
    num_check = work_num_check(num, g_constructionData);
    if (num_check) {
      createErrorMessage("num_div", "err_num", num_check);
      err_flg = true;
    } else {
      removeErrorMessage(errNum);
    }
  } else {
    err_flg = true;
  }

  let num_name = document.getElementById("work_num_name").value;
  let num_full_name = "";

  if ( num_name ) {
    for (let i = 0 ; i < g_constructionData.length; ++i ) {
      if ( g_constructionData[i][1] == num ) {
        num_full_name = g_constructionData[i][5];
      }
    }
  } else {
    createErrorMessage("num_div", "err_num", "工事名が選択されていません");
    err_flg = true;
  }

  if (!start_hour || !start_minute || !end_hour || !end_minute || !cord || !num || !num_name || !num_full_name || !cord_full_name) {
    not_entry();
    return;
  } else {
    removeErrorMessage(document.getElementById("err_entry"));
  }

    //エラーログが存在する場合、それを出現させる.
  if ( document.getElementById("err_entry") ){
    document.getElementById("err_entry").style.display = "block";
  }


  if ( err_flg ) {
    not_entry(1);
    // エラーがある場合、処理をスキップする
    return;
  }


  //現在の日付(Urlに書いてある時間)をDate型にして配列に格納.
  let date = g_currentDate.split("-");
  let year = parseInt(date[0]);
  let month = parseInt(date[1])-1;
  let day = parseInt(date[2]);

  // Date オブジェクトの初期化
  let inputDate = new Date(year, month, day, 12, 0, 0);  // 時間を 12 時 0 分 0 秒にセット

  // 変換後のフォーマットを指定
  let options = {
    weekday: 'short',
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: 'numeric',
    minute: 'numeric',
    second: 'numeric',
    timeZoneName: 'short',
  };

  // 指定されたフォーマットに変換
  let formattedDate = new Intl.DateTimeFormat('en-US', options).format(inputDate);

  // チェック完了
  g_addary = [g_employeeId, start_hour + ":" + start_minute, end_hour + ":" + end_minute, cord, num, num_name, cord_chkbx+"", num_chkbx+"", num_full_name, cord_full_name,formattedDate];

  entry_btn.setAttribute("onclick", "modal_entry()");
}

// フォームの入力状況を初期化する関数.
function resetForm() {
  //前回の終了時間を開始時間に持ってくる.
  let endH = document.getElementById("end_hour").selectedIndex;
  let endM = document.getElementById("end_minute").selectedIndex;

  document.getElementById("start_hour").selectedIndex = endH;
  document.getElementById("start_minute").selectedIndex = endM;

  document.getElementById("end_hour").selectedIndex = 0;
  document.getElementById("end_minute").selectedIndex = 0;

  $(".error_msg").remove();
}

//入力が足りない時に追加ボタンを押すと発火する関数 modeはチェックボックス関連のエラーが起きている時に呼び出される,
function not_entry( mode ) {
  let start_hour = document.getElementById("start_hour").value; //開始時間.
  let start_minute = document.getElementById("start_minute").value; //開始時間.
  let end_hour = document.getElementById("end_hour").value; //終了時間.
  let end_minute = document.getElementById("end_minute").value; //終了時間.
  let cord = document.getElementById("work_cord").value; //作業コード
  let num = document.getElementById("work_num").value; //工事No.
  let num_name = document.getElementById("work_num_name").value;
  let err_txt = "次の項目の入力が足りていません<br>【　";

  if( mode != "1" ){
    if( start_hour == ""  || start_minute == "") {
      err_txt += "開始時間　";
    }
    if( end_hour == ""  || end_minute == "") {
      err_txt += "終了時間　";
    }
    if( cord == "") {
      err_txt += "作業コード　";
    }
    if( num == "" || num_name == "") {
      err_txt += "工事No　";
    }
    createErrorMessage("entry_txt", "err_entry", err_txt+"】");
  } else {
    err_txt = "入力内容にエラーがあります";
    createErrorMessage("entry_txt", "err_entry", err_txt);
  }
}


//日報追加ボタンが押下された場合の関数.
function modal_entry(){
  //ボタンのオンクリック属性の排除.
  let entry_btn = document.getElementById("entry");
  entry_btn.removeAttribute("onclick");
  $('#end_div').toggleClass('active');

  if( g_mode == "add" ) {
    g_addary[11] = "add";
    g_report_data.push(g_addary);
  } else {
    //現在の配列の末尾に、編集として追加.
    g_addary[11] = "edit";
    g_report_data[ g_mode ] = g_addary;
  }
  report_table_create(g_report_data, "work_report");

  resetForm();
  close_modal();
}

/* モーダルウインドウ関連の関数終了 */

/* 日報一覧表を作成するプログラム開始 */
//引数0には日報情報を、1には追加するidを指定
function report_table_create(ary, idname) {



  //追加するdiv要素の特定.
  let add_div = document.getElementById(idname);

  // 子要素を全て削除
  while (add_div.firstChild) {
    add_div.removeChild(add_div.firstChild);
  }

  //配列が初期化された場合に、アラートメッセージをもう一度出現させる処理.
  let reportCount = 0;
  for ( let c = 0; c < ary.length; ++c ) {
    if ( ary[c][0]+"" == g_employeeId ){

      let report_date = new Date(ary[c][10]);

      let date = g_currentDate.split("-");
      let year = parseInt(date[0]);
      let month = parseInt(date[1])-1;
      let day = parseInt(date[2]);

      let report_dates = [report_date.getFullYear(),report_date.getMonth(),report_date.getDate()];

      if ( report_dates[0] == year && report_dates[1] == month && report_dates[2] == day ) {
        if( ary[c][11] == "delete" ){
          continue;
        }
        ++reportCount
      }
    }
  }

  let sendFlg = true;


  if ( reportCount == 0 ) {
    let alert = document.getElementById(idname);
    let msg = document.createElement('p'); //ひな形作成.
    if ( g_change_flg ) {
      msg.textContent = "日報の変更を送信しますか？"; //テキスト設定.
      let entry_btn = document.getElementById("entry");
      entry_btn.removeAttribute("onclick");
      entry_btn.setAttribute("onclick", "send_report()"); //オンクリック属性を作成.
    } else {
      msg.textContent = "また日報が作成されていません"; //テキスト設定.
    }
    msg.classList.add("alert_msg"); //クラスを追加.
    alert.prepend(msg);
  }

  //テーブルの作成処理.
  for (let i = 0; i < ary.length; ++i) {

    //現在の日報配列の社員IDが、現在ログイン中の社員と違ったらスキップ.
    if ( ary[i][0]+"" != g_employeeId ){
      continue;
    }
    let report_date = new Date(ary[i][10]);
    let report_dates = [report_date.getFullYear(),report_date.getMonth(),report_date.getDate()];

    let date = g_currentDate.split("-");
    let year = parseInt(date[0]);
    let month = parseInt(date[1])-1;
    let day = parseInt(date[2]);

    if ( report_dates[0] != year || report_dates[1] != month || report_dates[2] != day ) {
      continue;
    }

    if ( ary[i][11] == "delete" ) {
      continue;
    }

    //作業コードやらを入れる配列.
    let cord_ary = [];

    // 作業コードの下処理.
    for (let key in g_workCategories) {
      for (let c = 0; c < g_workCategories[key].length; ++c) {
         if (g_workCategories[key][c][0] == ary[i][3]) {
          cord_ary =[
            ary[i][3],
            key,
            g_workCategories[key][c][1] // テキストを抽出.
          ];
          break;
        }
      }
    }

    //div要素定義.
    let report_div = document.createElement('div'); //日報を格納する親div要素の定義.
    let report_bg1 = document.createElement('div'); //日報を格納するdiv要素の背景1.
    let report_bg2 = document.createElement('div'); //日報情報を格納するdiv要素の背景2 ここに日報情報が実際に入る.

    //作成したdiv要素にclassを定義.
    report_div.classList.add("mother_report"); //クラス追加.
    report_bg1.id = i; // ID属性をg_daily_dataと同じ連番で設定.
    report_bg1.classList.add("report_bg1"); //クラス追加
    report_bg2.classList.add("report_bg2"); //クラス追加.

    //div要素の追加.
    add_div.appendChild(report_div);
    report_div.appendChild(report_bg1);
    report_bg1.appendChild(report_bg2);


    //モーダルの場合の確認用メッセージの作成.
    if ( idname == "modal_report" && sendFlg) {
      let msg = document.createElement('p'); //ひな形作成.
      msg.textContent = "以下の内容で送信しますか?"; //テキスト設定.
      msg.classList.add("alert_msg"); //クラスを追加.
      report_div.prepend(msg);
      let entry_btn = document.getElementById("entry");
      entry_btn.removeAttribute("onclick");
      entry_btn.setAttribute("onclick", "send_report()"); //オンクリック属性を作成.
      sendFlg = false;
    } else if (idname == "work_report") {
      report_bg1.setAttribute('onclick', "show_report(this.id)"); //onclick属性を追加.
    }

    //日報情報を作成する.
    for (let j = 0; j < ary[i].length; ++j) {
      let report_text = document.createElement('p'); //日報のテキストのひな形
      report_text.classList.add("report_msg"); //クラス追加.

      //日報を格納する処理.
      //もし、インデックスが開始時間ならば.
      if (j == 1) {
        report_text.innerHTML = "開始時間：" + ary[i][j]; //テキストを設定.
        //もし、インデックスが終了時間ならば.
      } else if (j == 2) {
        report_text.innerHTML = "終了時間：" + ary[i][j]; //テキストを設定.

        //もし、インデックスが作業コードならば.
      } else if (j == 3) {
        let flgtxt = "無し";
        if (ary[i][6]) {
          flgtxt = "あり";
        }
        report_text.innerHTML = "作業コード：" + cord_ary[0] + "(" + cord_ary[1] + "：" + cord_ary[2] + ")<br>" + "手直し：" + flgtxt; //テキストを設定.

        //もし、インデックスが工事Noならば.
      } else if (j == 4) {
        let flgtxt = "無し";
        if (ary[i][7]) {
          flgtxt = "あり";
        }
        report_text.innerHTML = "工事No：" + ary[i][j] + "　" + ary[i][5] + "<br>現場出向など：" + flgtxt; //テキストを設定.
      } else {
        continue;
      }
      report_bg2.appendChild(report_text); //日報情報を追加.
    }
  }
  //勤務時間区分の表示.
  //ログインした社員でないものの日報排除は、次の関数にておこなう.
  worKStyleCalc(ary);
}
/* 日報一覧表を作成すプログラム終了 */

/* 日報を追加する関数開始 */

function report_send(){
  document.getElementById('modal_win').style.display = "block"; //モーダルを出現させる.
  document.getElementById("modal_form").style.display = "none"; //モーダルのフォーム要素を見えなくする.
  document.getElementById("modal_title").textContent = "日報送信の確認"; //モーダルのタイトルを変える.
  document.getElementById("entryTxt").textContent = "送信";
  document.getElementById("modal_report").style.display = "flex";
  if( g_report_data.length == 0 ){
    return;
  }else {
    report_table_create(g_report_data, "modal_report");
  }

  if ( document.getElementById("err_entry") ){
    document.getElementById("err_entry").style.display = "none";
  }
}


/* 日報を追加する関数終了 */


//日報を参照した時、モーダルに入力を加える処理.
function show_report(reportId) {

  if( !$("#end_div").hasClass("active") ) {
    $('#end_div').toggleClass('active');
  }
  const modal = document.getElementById('modal_win'); //モーダルの親要素.
  document.getElementById("modal_form").style.display = "block"; //日報追加用モーダル.
  document.getElementById("modal_title").textContent = "日報編集"; //日報タイトル.
  document.getElementById("entryTxt").textContent = "変更";
  modal.style.display = 'block';
  document.getElementById("modal_report").style.display = "none"; // 日報非入力時のアラートメッセージや日報一覧の無力化
  //ボタンのオンクリック属性の排除.
  let entry_btn = document.getElementById("entry");
  entry_btn.removeAttribute("onclick");
  g_mode = reportId;

  let del_btn = document.getElementById("del");
  document.getElementById("delete_btns").style.display = "block"; // 日報削除ボタンの出現.
  //削除ボタンにオンクリック属性を削除してから付ける.
  del_btn.removeAttribute("onclick");
  del_btn.setAttribute("onclick", "report_del('" + reportId + "')"); //オンクリック属性を付ける.

  //フォームの入力状況の設定.

  let start_hour = document.getElementById("start_hour");
  let start_minute = document.getElementById("start_minute");
  let end_hour = document.getElementById("end_hour");
  let end_minute = document.getElementById("end_minute");

  let shour_op = start_hour.options;
  let sminute_op = start_minute.options;

  for(let i = 0; i < shour_op.length ; ++i) {
    if ( shour_op[i].value == g_report_data[reportId][1].split(":")[0]) {
      start_hour.selectedIndex = i;
    }
  }
  for(let i = 0; i < sminute_op.length ; ++i) {
    if ( sminute_op[i].value == g_report_data[reportId][1].split(":")[1]) {
      start_minute.selectedIndex = i;
    }
  }

  let ehour_op = end_hour.options;
  let eminute_op = end_minute.options;

  for(let i = 0; i < ehour_op.length; ++i) {
    if ( ehour_op[i].value == g_report_data[reportId][2].split(":")[0] ) {
      end_hour.selectedIndex = i;
    }
  }
  for(let i = 0; i < eminute_op.length; ++i) {
    if ( eminute_op[i].value == g_report_data[reportId][2].split(":")[1] ) {
      end_minute.selectedIndex = i;
    }
  }

  let dropdown = document.getElementById("work_cord");

  // ドロップダウン内のオプションをリストとして取得
  var options = dropdown.options;


  // ドロップダウンのリストを表示
  for (var i = 0; i < options.length; i++) {
    if( options[i].value.split(" ")[0] == g_report_data[reportId][3] ) {
      document.getElementById("work_cord").selectedIndex = i;
    }
  }

  document.getElementById("work_num").value = g_report_data[reportId][4]; //工事No.
  document.getElementById("work_num_name").value = g_report_data[reportId][5]; //工事名.
  document.getElementById("cord_chkbx").checked = JSON.parse(g_report_data[reportId][6].toLowerCase()); //N.
  document.getElementById("num_chkbx").checked = JSON.parse(g_report_data[reportId][7].toLowerCase()); //A.
  report_direction();
}

function send_report() {

  document.getElementById("page_loading").style.display = "block";
  document.getElementById("loading_text").textContent = "日報送信中";

  google.script.run.withSuccessHandler(async function(ret) {
    if (ret == true) {
      document.getElementById("loading_text").innerHTML = "日報送信完了";
      await wait(1000);
      document.getElementById("page_loading").style.display = "none";
      document.getElementById("page_road_popup").style.display = "block";
      document.getElementById("popup_text").innerHTML = "日報送信が行われました<br>日時選択画面に戻りますか?<br>";

      let url = "<?=getScriptUrl()?>?p=calendar&name="+g_employeeName+"&id="+g_employeeId;
      document.getElementById("popup_entry_btn").setAttribute("href", encodeURI(url));
    } else {
      console.log(ret)
      document.getElementById("page_loading").style.display = "none";
      alert("日報が送信できませんでした。もう一度お願いします");
    }
  }).daily_report(g_report_data, g_sheet);
}

//　日報を削除する関数削除する配列のインデックスを記載.
function report_del( reportid ) {
  if ( g_report_data[reportid].length == 11 ) {
    g_report_data[reportid] = g_report_data[reportid].fill("-"); //arrayの値を全て-に.
    g_report_data[reportid][11] = "delete";
    //変更履歴をtrueとする 日報データを削除した際に日報データがなくなった場合、その変更を確定させるため.
    g_change_flg = true;
    let entry_btn = document.getElementById("entry");
    entry_btn.removeAttribute("onclick");
    entry_btn.setAttribute("onclick", "send_report()"); //オンクリック属性を作成.
  } else {
    g_report_data[reportid] = g_report_data[reportid].fill("-"); //arrayの値を全て-に.
  }

  report_table_create(g_report_data, "work_report"); //テーブルの作り直し.
  report_table_create(g_report_data, "modal_report");
  worKStyleCalc(g_report_data); //区分合計時間の計算し直し.
  resetForm();
  close_modal();
}

//(開始時間,終了時間,休憩時間)から、休憩時間を含めない総労働時間を返す(int型)関数 modeの0は、30分区切りをせず、途中で抜け出すパターン.
function totalWorkingCalc(workStartMinutes, workEndMinutes, timeAry, mode) {

  // 休憩時間を含む総労働時間を計算.
  let totalWorkMinutes = workEndMinutes - workStartMinutes;

  for (let i = 1; i < timeAry.length; ++i) {
    const breakStartMinutes = timeCalc(timeAry[i][0]);
    //開始時間が休憩の開始時間以上かつ、終了時間より小さい場合.
    if ( workStartMinutes <= breakStartMinutes && breakStartMinutes < workEndMinutes) {
      totalWorkMinutes -= parseInt(timeAry[i][1]);
    }
  }

  if ( mode == 0 ) {
    return totalWorkMinutes;
  }

  //30分区切りにする.
  if ( totalWorkMinutes < 30 ) {
    return 0;
  } else if ( totalWorkMinutes % 60 == 0 || totalWorkMinutes % 30 == 0 ) {
    return totalWorkMinutes;
  } else if ( totalWorkMinutes % 60 >= 30 ) {
    return  Math.floor(totalWorkMinutes / 60) * 60 + 30;
  } else if ( totalWorkMinutes % 60 <= 30 ) {
    return  Math.floor(totalWorkMinutes / 60) * 60;
  }
}

// 日報配列 から勤務形態(早出など)と色を設定する関数.
function worKStyleCalc(reportData) {
  // 日報データをまたいだ勤務区分ごとの時間を格納する配列.
  let workTimeAry = [];

  // 追加先のDiv要素のクリーン化.
  let addDiv = document.getElementById("reportWorkStyle");

  // 子要素を全て削除.
  while (addDiv.firstChild) {
    addDiv.removeChild(addDiv.firstChild);
  }

  let reportCount = 0;

  for ( let c = 0; c < reportData.length; ++c ) {
    if ( reportData[c][0]+"" == g_employeeId ){

      let report_date = new Date(reportData[c][10]);
      let report_dates = [report_date.getFullYear(),report_date.getMonth(),report_date.getDate()];

      let date = g_currentDate.split("-");
      let year = parseInt(date[0]);
      let month = parseInt(date[1])-1;
      let day = parseInt(date[2]);

      if ( report_dates[0] == year && report_dates[1] == month && report_dates[2] == day ) {
        if( reportData[c][11] == "delete" ){
          continue;
        }
        ++reportCount
      }
    }
  }

  if ( reportCount == 0 ) {
    document.getElementById("report_totalWorkText").textContent = "0時間";
  }

  for (let i = 0; i < reportData.length; ++i) {

    //現在の日報配列の社員IDが、現在ログイン中の社員と違ったらスキップ.
    if ( reportData[i][0]+"" != g_employeeId ){
      continue;
    }

    let report_date = new Date(reportData[i][10]);
    let report_dates = [report_date.getFullYear(),report_date.getMonth(),report_date.getDate()];

    let date = g_currentDate.split("-");
    let year = parseInt(date[0]);
    let month = parseInt(date[1])-1;
    let day = parseInt(date[2]);

    if ( report_dates[0] != year || report_dates[1] != month || report_dates[2] != day ) {
      continue;
    }
    if( reportData[i][11] == "delete" ){
      continue;
    }


    // 時間を分に変換.
    const workStartMinutes = timeCalc(reportData[i][1]);
    const workEndMinutes = timeCalc(reportData[i][2]);

    for (let j = 1; j < g_work_style.length; ++j) {
      // 労働開始時間と終了時間を時間と分に分割.
      let startMinutes = timeCalc(g_work_style[j][1]);
      let endMinutes = timeCalc(g_work_style[j][2]);

      // 一時的に終了・開始時間を入れる為の変数.
      let tmpEndMinutes = 0;
      let tmpStartMinutes = 0;

      // 背景色を設定.
      if (startMinutes <= workStartMinutes && workStartMinutes < endMinutes) {
        document.getElementById(i).style.backgroundColor = g_work_style[j][3];
      }

      // 区分範囲内の正しい終了時間を設定.
      //開始時間が、区分の開始時間内かつ、終了時間内である場合、開始時間を変更せず設定.
      if ( startMinutes <= workStartMinutes && workStartMinutes < endMinutes ) {
        tmpStartMinutes = workStartMinutes;

        //開始時間が、区分開始時間よりも短い場合、区分開始時間に設定.
      } else if ( workStartMinutes <= startMinutes ) {
        tmpStartMinutes = startMinutes;

        //開始時間が、区分終了時間よりも多い場合、処理をスキップ.
      } else if ( endMinutes < workStartMinutes ) {
        continue;
      }

      //終了時間が、区分開始時間よりも多く、区分終了時間よりも短い場合、そのまま終了時間を格納.
      if ( startMinutes < workEndMinutes && workEndMinutes <= endMinutes) {
        tmpEndMinutes = workEndMinutes;

        //終了時間が、区分終了時間よりも大きい場合、区分終了時間を格納.
      } else if ( endMinutes <= workEndMinutes ) {
        tmpEndMinutes = endMinutes;

        //終了時間が、区分終了時間よりも小さい場合、処理をスキップ.
      } else if ( workEndMinutes < endMinutes ) {
        continue;
      }

      let totalTime = 0;
      // 時間合計を計算.
      //勤務形態スプレッドシートにある情報から、昇順に"早出”,(労働時間)の様に格納されていく.
      //何も定義されていない場合は0を格納.
      if (!workTimeAry[j - 1]) {
        workTimeAry[j - 1] = [g_work_style[j][0], 0];
      }

      //情報が入ってきている途中の為、三十分区切りにせず受け取る.
      totalTime = totalWorkingCalc(tmpStartMinutes, tmpEndMinutes, breakTimeAry, 0);
      if ( totalTime >= 0 ) {
        workTimeAry[j - 1][1] += totalTime;
      }
    }
  }

  let totalWorkMinutes = 0;

  //区分ごとにfor文を回す,
  for (let j = 0; j < workTimeAry.length; ++j) {

    //　区分に作業時間が割り当てられていない場合はスキップ.
    if( !workTimeAry[j] && j != workTimeAry.length ) {
      continue;
    }

    let workStyleText = document.createElement('p'); // 日報のテキストのひな形
    workStyleText.classList.add("reportWorkStyleTxt"); // クラス追加.

    let time = "";
    if (workTimeAry[j][1] < 30) {
      continue;

    }

    time = Math.floor(workTimeAry[j][1] / 60) + "時間";
    totalWorkMinutes += Math.floor(workTimeAry[j][1] / 60)*60;

    if ( workTimeAry[j][1] % 60 >= 30 ) {
      time += "30分";
      totalWorkMinutes += 30;
    }


    workStyleText.innerHTML = g_work_style[j + 1][0] + ":" + time;
    addDiv.appendChild(workStyleText);
  }
  let workTxt = document.getElementById("report_totalWorkText"); //id要素の取得.
  let totalWorkTimeTxt = "";

  //30分区切りにする.
  if ( totalWorkMinutes < 30 ) {
    totalWorkTimeTxt = "0時間";
  } else {
    totalWorkTimeTxt = Math.floor(totalWorkMinutes / 60) + "時間";
  }

  if ( totalWorkMinutes % 60 >= 30 ) {
    totalWorkTimeTxt += "30分";
  }

  if (reportCount >= 1 && totalWorkMinutes > 30) {
    document.getElementById("reportWorkStyle").style.display = "flex";
  } else {
    document.getElementById("reportWorkStyle").style.display = "none";
    return;
  }

  workTxt.textContent = totalWorkTimeTxt;
}

// 時間(〇〇:〇〇)の形式を入れられたら、分で返す関数.
function timeCalc(timeStr) {
  const timeParts = timeStr.split(":");

  let minutes = 0;

  // 翌日の入力が入っていた場合　1440分を加算.
  if (timeParts[0].indexOf("翌") != -1) {
    let tmp = timeParts[0].slice(1);
    // 時間を分に変換.
    minutes = parseInt(tmp) * 60 + parseInt(timeParts[1]) + 1440;
  } else {
    minutes = parseInt(timeParts[0]) * 60 + parseInt(timeParts[1]);
  }

  return minutes;
}


//テキストボックスのテキストカラーを、時間ごとに変更する関数.
function textColorChange ( minutes, textName, textName2 ) {
  let textId = document.getElementById(textName);
  let textId2 = document.getElementById(textName2);

  for (let j = 1; j < g_work_style.length; ++j) {
    // 労働開始時間と終了時間を時間と分に分割.
    let startMinutes = timeCalc(g_work_style[j][1]);
    let endMinutes = timeCalc(g_work_style[j][2]);

    // 色を設定　勤務形態シートから参照.
    if (startMinutes <= minutes && minutes < endMinutes) {
      textId.style.color = g_work_style[j][3];
      textId2.style.color = g_work_style[j][3];
      return;
    }
  }
  textId.style.color = "#000";
  textId2.style.color = "#000";
}

function page_relord() {
  win_lock = false;

  link = "<?=getScriptUrl()?>?p=report&name=" + g_employeeName + "&id=" + g_employeeId + "&date=" + g_currentDate;
  window.open(link, '_top');
}




  </script>
</head>

<body>
  <div id="page_road_popup">
    <div class="popup_bg1">
      <div class="popup_bg2">
        <p id="popup_text"></p>
        <div class="popup_btn_group">
          <a class="popup_back_btn" onclick="page_relord()">いいえ</a>
          <a id="popup_entry_btn">はい</a>
        </div>
      </div>
    </div>
  </div>
  <div id="page_loading">
    <div class="wrapper">
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="circle"></div>
      <div class="shadow"></div>
      <div class="shadow"></div>
      <div class="shadow"></div>
      <span id="loading_text">読み込み中・・・</span>
    </div>
  </div>
  <div style="display: flex;flex-direction: column;align-items: center;">
    <header class="reportHeader">
      <div class="employeeInfoDiv">
        <svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" viewBox="0 0 34 34" fill="none">
          <path
            d="M33.7125 31.9648C31.2986 27.6249 27.5786 24.5129 23.2372 23.0377C25.3846 21.7083 27.053 19.6826 27.9862 17.2717C28.9194 14.8608 29.0658 12.198 28.4029 9.69227C27.7399 7.18649 26.3043 4.97629 24.3166 3.40109C22.3288 1.82589 19.8988 0.972778 17.3996 0.972778C14.9005 0.972778 12.4705 1.82589 10.4827 3.40109C8.49492 4.97629 7.05934 7.18649 6.3964 9.69227C5.73346 12.198 5.87983 14.8608 6.81302 17.2717C7.7462 19.6826 9.41462 21.7083 11.562 23.0377C7.2207 24.5113 3.50068 27.6232 1.08672 31.9648C0.998192 32.1149 0.939474 32.2819 0.914028 32.456C0.888581 32.6301 0.896922 32.8077 0.938557 32.9784C0.980191 33.1491 1.05428 33.3093 1.15644 33.4498C1.25861 33.5902 1.38679 33.7079 1.53341 33.796C1.68004 33.8841 1.84214 33.9407 2.01015 33.9626C2.17817 33.9844 2.3487 33.9711 2.51167 33.9233C2.67465 33.8755 2.82677 33.7943 2.95907 33.6844C3.09136 33.5745 3.20115 33.4381 3.28195 33.2834C6.26811 27.9166 11.5462 24.7124 17.3996 24.7124C23.2531 24.7124 28.5311 27.9166 31.5173 33.2834C31.5981 33.4381 31.7079 33.5745 31.8402 33.6844C31.9725 33.7943 32.1246 33.8755 32.2876 33.9233C32.4506 33.9711 32.6211 33.9844 32.7891 33.9626C32.9571 33.9407 33.1192 33.8841 33.2658 33.796C33.4125 33.7079 33.5406 33.5902 33.6428 33.4498C33.745 33.3093 33.8191 33.1491 33.8607 32.9784C33.9023 32.8077 33.9107 32.6301 33.8852 32.456C33.8598 32.2819 33.8011 32.1149 33.7125 31.9648ZM8.52358 12.8448C8.52358 11.0192 9.04415 9.23465 10.0195 7.71673C10.9948 6.19881 12.381 5.01574 14.0029 4.31712C15.6248 3.61849 17.4095 3.4357 19.1313 3.79186C20.853 4.14801 22.4346 5.02711 23.6759 6.318C24.9173 7.60888 25.7626 9.25357 26.1051 11.0441C26.4476 12.8346 26.2718 14.6905 25.6 16.3771C24.9282 18.0637 23.7906 19.5053 22.3309 20.5196C20.8712 21.5338 19.1551 22.0752 17.3996 22.0752C15.0463 22.0725 12.7901 21.0992 11.1261 19.3688C9.46206 17.6383 8.5261 15.2921 8.52358 12.8448Z"
            fill="white" />
        </svg>
        <div class="employeeInfo">
          <p class="employeeId">
            ID:
            <?= id ?>
          </p>
          <p class="employeeName">
            名前:
            <?= name ?>
          </p>
        </div>
      </div>
      <a href="<?=getScriptUrl()?>" class="logoutBtnBg">
        <p class="logoutText">ログアウト</p>
        <svg xmlns="http://www.w3.org/2000/svg" width="33" height="33" viewBox="0 0 37 37" fill="none">
          <path
            d="M25.5714 2H6.71429C5.46398 2 4.26488 2.38631 3.38078 3.07394C2.49668 3.76158 2 4.69421 2 5.66667V31.3333C2 32.3058 2.49668 33.2384 3.38078 33.9261C4.26488 34.6137 5.46398 35 6.71429 35H25.5714M35 18.5L25.5714 11.1667M35 18.5L25.5714 25.8333M35 18.5H11.4286"
            stroke="black" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </a>
    </header>
    <div id="modal_win" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <p id="modal_title">日報報告</p>
        </div>
        <div class="modal-body">
          <div id="modal_report">
            <p class="alert_msg">まだ日報が作成されていません</p>
          </div>
          <div id="modal_form">
            <div id="start_div" class="form_group">
              <p class="form_title">開始時間</p>
              <form class="time_form">
                <select id="start_hour" class="form_dropdown" oninput="report_direction()">
                  <option value="" disabled selected></option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                  <option value="20">20</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                  <option value="24">24</option>
                  <option value="翌1">翌1</option>
                  <option value="翌2">翌2</option>
                  <option value="翌3">翌3</option>
                  <option value="翌4">翌4</option>
                  <option value="翌5">翌5</option>
                </select>
                <p class="time_colon">:</p>
                <select id="start_minute" class="form_dropdown" oninput="report_direction()">
                  <option value="" disabled selected></option>
                  <option value="00">00</option>
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="30">30</option>
                  <option value="40">40</option>
                  <option value="50">50</option>
                </select>
              </form>
            </div>
            <div id="end_div" class="form_group">
              <p class="form_title">終了時間</p>
              <form class="time_form">
                <select id="end_hour" class="form_dropdown" oninput="report_direction()">
                  <option value="" disabled selected></option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                  <option value="20">20</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                  <option value="24">24</option>
                  <option value="翌1">翌1</option>
                  <option value="翌2">翌2</option>
                  <option value="翌3">翌3</option>
                  <option value="翌4">翌4</option>
                  <option value="翌5">翌5</option>
                </select>
                <p class="time_colon">:</p>
                <select id="end_minute" class="form_dropdown" oninput="report_direction()">
                  <option value="" disabled selected></option>
                  <option value="00">00</option>
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="30">30</option>
                  <option value="40">40</option>
                  <option value="50">50</option>
                </select>
              </form>
            </div>
            <div id="cord_div" class="form_group">
              <p class="form_title">作業コード</p>
              <form>
                <select id="work_cord" class="form_dropdown" oninput="report_direction()">
                  <option value="" disabled selected>作業コードを選択</option>
                </select>
              </form>
              <label class="work_checkbox_label">
                <input type="checkbox" id="cord_chkbx" oninput="report_direction()">
                <p class="work_checkbox_text">N</p>
              </label>
            </div>
            <div id="num_div" class="form_group">
              <p class="form_title">工事No</p>
              <div class="num_div">
                <div class="num_div2">
                  <input id="work_num" type="text" class="form_textbox_num" placeholder="工事No" maxlength="4" oninput="report_direction()">
                  <input id="work_num_name" type="text" readonly placeholder="工事名">
                </div>
                <div id="num_suggest"></div>
              </div>
              <label class="work_checkbox_label">
                <input type="checkbox" id="num_chkbx" oninput="report_direction()">
                <p class="work_checkbox_text">A</p>
              </label>
            </div>
            <div class="form_group">
              <p class="form_title">総労働時間</p>
              <p class="totalWork" id="totalWorkText">0時間</p>
            </div>
          </div>
          <div id="btns" class="report_btn_group">
            <div class="close_btn" onclick="close_modal()">
              <p class="btn_text">キャンセル</p>
            </div>
            <div class="entry_btn" id="entry" onclick="not_entry()">
              <p id="entryTxt" class="btn_text" style="color: #fff;">追加</p>
            </div>
          </div>
          <div id="entry_txt"></div>
          <div id="delete_btns" class="report_btn_group">
            <div class="del_btn">
              <p id="del" class="btn_text" style="color: #F05454;">日報削除</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="carendar_bg_1">
      <div class="carendar_bg_2">
        <div class="carendar_info_bg">
          <div id="date" class="carendar_date_wiget"></div>
        </div>
        <div id="work_report">
          <p class="alert_msg">まだ日報が作成されていません</p>
        </div>
        <div id="reportWorkStyle">
        </div>
        <div class="reportTotalWork">
          <div class="report_form_title_div">
            <p class="report_form_title">総労働時間</p>
          </div>
          <p class="totalWork" id="report_totalWorkText">0時間</p>
        </div>
      </div>
    </div>
    <div class="edit_btn_bg_1" onclick="open_modal()">
      <div class="edit_btn_bg_2">
        <div class="edit_btn_bg_3">
          <p class="edit_text">日報を追加する</p>
        </div>
      </div>
    </div>
    <div class="send_btn_bg_1" onclick="report_send()">
      <div class="send_btn_bg_2">
        <a class="send_btn_text">送信</a>
      </div>
    </div>
  </div>
</body>

</html>